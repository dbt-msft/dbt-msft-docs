<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Synapse Syntax Wish List | dbt-sqlserver-docs</title><meta data-react-helmet="true" property="og:url" content="https://dbt-msft.github.io//dbt-msft-docs/docs/dbt-synapse/synapse_syntax_wishlist"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Synapse Syntax Wish List | dbt-sqlserver-docs"><meta data-react-helmet="true" name="description" content="goal"><meta data-react-helmet="true" property="og:description" content="goal"><link data-react-helmet="true" rel="shortcut icon" href="/dbt-msft-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dbt-msft.github.io//dbt-msft-docs/docs/dbt-synapse/synapse_syntax_wishlist"><link data-react-helmet="true" rel="alternate" href="https://dbt-msft.github.io//dbt-msft-docs/docs/dbt-synapse/synapse_syntax_wishlist" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dbt-msft.github.io//dbt-msft-docs/docs/dbt-synapse/synapse_syntax_wishlist" hreflang="x-default"><link rel="stylesheet" href="/dbt-msft-docs/assets/css/styles.6a51eaf8.css">
<link rel="preload" href="/dbt-msft-docs/assets/js/runtime~main.82d8ab17.js" as="script">
<link rel="preload" href="/dbt-msft-docs/assets/js/main.51c2c29b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dbt-msft-docs/"><img src="/dbt-msft-docs/img/dbt-msft-logo.png" alt="dbt Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/dbt-msft-docs/img/dbt-msft-logo.png" alt="dbt Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">dbt-msft-docs</b></a><a class="navbar__item navbar__link navbar__link--active" href="/dbt-msft-docs/docs/dbt-sqlserver/overview">dbt-sqlserver</a><a class="navbar__item navbar__link navbar__link--active" href="/dbt-msft-docs/docs/dbt-synapse/overview">dbt-synapse</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dbt-msft" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/dbt-msft-docs/docs/better_together_pitch">dbt and MSFT - Better Together</a></li><li class="menu__list-item"><a class="menu__link" href="/dbt-msft-docs/docs/training">dbt Training Crash Course</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">dbt-sqlserver</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started Guides</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">dbt-synapse</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dbt-msft-docs/docs/dbt-synapse/overview">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/dbt-msft-docs/docs/dbt-synapse/synapse_syntax_wishlist">Synapse Syntax Wish List</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/dbt-msft-docs/docs/ado_pipelines_example">Azure DevOps Pipelines Example</a></li><li class="menu__list-item"><a class="menu__link" href="/dbt-msft-docs/docs/nested_CTES">Nested CTES in TSQL, a treatise</a></li><li class="menu__list-item"><a class="menu__link" href="/dbt-msft-docs/docs/contributing">Contributing to dbt-msft-docs</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Synapse Syntax Wish List</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="goal"></a>goal<a class="hash-link" href="#goal" title="Direct link to heading">#</a></h2><p>maximize the amount of common TSQL syntax across:</p><ul><li>SQL Server 2016+</li><li>Azure SQL</li><li>Azure Synapse dedicated pool (ASDP)</li></ul><p>In doing this, Azure Data platform delivers:</p><ul><li>lower friction for moving<ul><li>b/w Azure data products, and</li><li>to Azure data prodcut from competitor&#x27;s products; and</li></ul></li><li>a better<ul><li>overall DW dev experience via ASDP (and dbt), and</li><li>open-source developer experience by reducing the amount of necessaary code to work with all Azure SQL products.</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rationale"></a>rationale<a class="hash-link" href="#rationale" title="Direct link to heading">#</a></h2><p>The syntactical difference between ANSI SQL PostgreSQL and TSQL is a barrier to entry for new customers to Azure.</p><p>Additionally, the intra-TSQL syntax differences are barriers to entry for users coming to ASDP from on-prem SQL Server. Making matters worse, <a href="https://github.com/MicrosoftDocs/azure-docs/issues/55713" target="_blank" rel="noopener noreferrer">there is no document</a> or cheatsheet published that details the differences and includes workarounds.</p><p>Fortunately for dbt users, the dbt-msft adapters, already handle these syntactic features. This means that a dbt project created in Azure SQL can be &quot;migrated&quot; to work on Azure Synapse by changing literally a single YAML parameter (provided the raw source tables already exist).</p><p>Nevertheless, a more standard API would greatly reduce friction of moving to and from the above products for ALL TSQL products. Our team already charged though these differences when moving our warehouse to ASDP before we learned of dbt.</p><p>Increasingly, data engineering tools are standardizing on SQL as the lingua franca for working with data. We can see this with:</p><ul><li>Synapse&#x27;s serverless pool which allows querying data lakes with a SQL PI, and</li><li>Databrick&#x27;s release of SQL Analytics -- which is effectively a SQL DW API on top of delta lake (<em><code>pyspark</code> and notebooks? never heard of them...</em>)</li></ul><p>One final benefit is that closer API alignment would drastically reduce the code footprint of this adapter. Instead, virtually all macros could be defined once in <code>dbt-sqlserver</code>, then be imported. This makes long-term maintenance easier, which, in open-source, is can be a sink-or-swim element.</p><header><h1 class="h1Heading_27L5">Syntax Differences</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-table-valued-constructor"></a>1) <a href="https://docs.microsoft.com/en-us/sql/t-sql/queries/table-value-constructor-transact-sql" target="_blank" rel="noopener noreferrer">Table Valued Constructor</a><a class="hash-link" href="#1-table-valued-constructor" title="Direct link to heading">#</a></h2><blockquote><p><a href="https://feedback.azure.com/forums/307516-azure-synapse-analytics/suggestions/43031034-add-support-for-the-table-value-constructor" target="_blank" rel="noopener noreferrer">relevant Uservoice Idea</a></p></blockquote><p>This is critical for the <code>dbt seed</code> command which loads a local csv into the the database.</p><p>The difference has brought the dev team <a href="https://stackoverflow.com/questions/65625384/why-does-inserting-empty-string-into-date-column-produce-1900-01-01" target="_blank" rel="noopener noreferrer">all</a> <a href="https://github.com/dbt-msft/dbt-synapse/issues/36" target="_blank" rel="noopener noreferrer">kinds</a> of problems</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="azure-sql"></a>Azure SQL<a class="hash-link" href="#azure-sql" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> dbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ceo </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nerd_cred</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Bill Gates&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Steve Ballmer&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Satyla Nadella&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="synapse"></a>Synapse<a class="hash-link" href="#synapse" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> dbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ceo </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nerd_cred</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Bill Gates&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UNION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ALL</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Steve Ballmer&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UNION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ALL</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Satyla Nadella&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-merge"></a>2) <code>MERGE</code><a class="hash-link" href="#2-merge" title="Direct link to heading">#</a></h2><blockquote><p><a href="https://feedback.azure.com/forums/307516-azure-synapse-analytics/suggestions/13520394--in-preview-merge-statement-support" target="_blank" rel="noopener noreferrer">relevant Uservoice Idea</a></p></blockquote><p>This is already in public preview, but would love know when it becomes <code>GA</code>. When it does, we can drop <a href="https://github.com/dbt-msft/dbt-synapse/blob/master/dbt/include/synapse/macros/materializations/snapshot/snapshot_merge.sql" target="_blank" rel="noopener noreferrer"><code>synapse__snapshot_merge_sql</code></a> macro with it&#x27;s <code>UPDATE-&gt;INSERT</code> workaround and rely on <a href="https://github.com/fishtown-analytics/dbt/blob/1060035838650a30e86989cbf2693db7720ff002/core/dbt/include/global_project/macros/materializations/snapshot/snapshot_merge.sql#L7-L25" target="_blank" rel="noopener noreferrer">the global project&#x27;s implementation</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> macro synapse__snapshot_merge_sql</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> insert_cols</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">%</span><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><span class="token operator" style="color:#393A34">%</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> insert_cols_csv </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> insert_cols </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;, &#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">%</span><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">EXEC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">           BEGIN TRANSACTION</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">           update {{ target }}</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          set dbt_valid_to = TMP.dbt_valid_to</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          from {{ source }} TMP</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          where {{ target }}.dbt_scd_id = TMP.dbt_scd_id</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            and TMP.dbt_change_type = &#x27;&#x27;update&#x27;&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            and {{ target }}.dbt_valid_to is null;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c">
</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            insert into {{ target }} (</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  {{ insert_cols_csv }}</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                  )</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            select {{ insert_cols_csv }}</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            from {{ source }} </span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            where dbt_change_type = &#x27;&#x27;insert&#x27;&#x27; ; </span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">           COMMIT TRANSACTION;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">           &#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> endmacro </span><span class="token operator" style="color:#393A34">%</span><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-drop--if-exists"></a>3) Drop ... if exists<a class="hash-link" href="#3-drop--if-exists" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="drop-tableviewschemaindex--if-exists"></a><code>DROP [TABLE/VIEW/SCHEMA/INDEX] ... IF EXISTS</code><a class="hash-link" href="#drop-tableviewschemaindex--if-exists" title="Direct link to heading">#</a></h3><blockquote><p><a href="https://feedback.azure.com/forums/307516-azure-synapse-analytics/suggestions/40068358-temporary-table-get-colunms-informations" target="_blank" rel="noopener noreferrer">relevant Uservoice idea</a> (&quot;suggested&quot; 2016, &quot;started&quot; 2018 &quot;planned&quot; 2019)</p></blockquote><p>This one is a lower priority because IMHO, using the first statement enables all the products including SQL Server &lt;2016. Though, the simplicity of the ssecond statement is alluring.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="azure-synapse--sql-server-2016"></a>Azure Synapse &amp; SQL Server &lt;2016<a class="hash-link" href="#azure-synapse--sql-server-2016" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> object_id </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;dbo.clippy&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;V&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">is</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> dbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clippy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="azure-sql--sql-server-201"></a>Azure SQL &amp; SQL Server &gt;=201<a class="hash-link" href="#azure-sql--sql-server-201" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> dbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clippy </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-accessing-data-from-blob-or-an-external-table"></a>4) Accessing data from blob or an external table<a class="hash-link" href="#4-accessing-data-from-blob-or-an-external-table" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="openrowset-vs-create-external-table-vs-copy-into"></a><code>OPENROWSET()</code> vs <code>CREATE EXTERNAL TABLE()</code> vs <code>COPY INTO</code><a class="hash-link" href="#openrowset-vs-create-external-table-vs-copy-into" title="Direct link to heading">#</a></h3><blockquote><p><a href="https://feedback.azure.com/forums/307516-azure-synapse-analytics/suggestions/42118774-openrowset-for-dedicated-pools" target="_blank" rel="noopener noreferrer">relevant Uservoice idea</a></p></blockquote><p>These API discrepancies are painfully confusing in that it&#x27;s a grab bag of nouns. The asks are:</p><ul><li>can there be common patterns for creating external tables across these TSQL products?</li><li>can Synapse support <code>RDBMS</code> External tables and Azure SQL support <code>HADOOP</code> External Tables?</li></ul><p>The impact on the dbt-msft project is how it affects <code>dbt-external-tables</code>, which currently supports rows 1 &amp; 4 of the table below.</p><p>There are huge UX gains left on the table with such disparate syntax across products. We&#x27;ll add more specific samples later</p><table><thead><tr><th>product</th><th>table type</th><th>type</th><th>statement</th><th>requires explicit columns</th><th>objects required</th></tr></thead><tbody><tr><td>Azure SQL</td><td>true external</td><td>RDBMS (i.e.   another database)</td><td>CREATE EXTERNAL   TABLE</td><td>yes</td><td>External   Datasource, Scoped Database Credential</td></tr><tr><td>Azure SQL</td><td>materialized external</td><td>RDBMS (i.e. another database)</td><td>INSERT INTO â€¦ OPENROWSET</td><td>yes</td><td>all defined in statement</td></tr><tr><td>Azure SQL</td><td>materialized external</td><td>HADOOP?</td><td>INSERT...SELECT * FROM   OPENROWSET(BULK...)</td><td>no</td><td>External File Format, External Datasource, Scoped Database Credential</td></tr><tr><td>ASDP</td><td>true   external</td><td>HADOOP (i.e. blob or datalake)</td><td>CREATE EXTERNAL TABLE</td><td>yes</td><td>External Datasource, External File Format, Scoped Database Credential</td></tr><tr><td>ASDP</td><td>materialized external</td><td>HADOOP?</td><td>COPY INTO [blob   path]</td><td>no</td><td>all   defined in statement</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-nested-ctes"></a>4) Nested CTEs<a class="hash-link" href="#4-nested-ctes" title="Direct link to heading">#</a></h2><p>As of now,  dbt data tests that are defined with CTEs fail, as the user-defined data test is itself wrapped into another CTE when executed. There&#x27;s a way to fix this, but it isn&#x27;t pretty. See <a href="https://github.com/dbt-msft/dbt-synapse/issues/25" target="_blank" rel="noopener noreferrer">#25</a></p><p>To clarify, this isn&#x27;t an ask for recursive CTEs, just nested ones. Here&#x27;s <a href="https://github.com/MicrosoftDocs/sql-docs/issues/5698" target="_blank" rel="noopener noreferrer">an issue opened on the SQL docs repo</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cant-be-done-in-asdp"></a>can&#x27;t be done in ASDP<a class="hash-link" href="#cant-be-done-in-asdp" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> dbt__CTE__INTERNAL_test </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> cte_test </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dbo&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token string" style="color:#e3116c">&quot;clippy&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TOP</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> cte_test</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> dbt__CTE__INTERNAL_test</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-sp_rename-unsupported-in-synapse-serverless-pools"></a>5) <code>sp_rename</code> unsupported in Synapse Serverless pools<a class="hash-link" href="#5-sp_rename-unsupported-in-synapse-serverless-pools" title="Direct link to heading">#</a></h2><p>You can&#x27;t rename views and external tables in Synapse serverless SQL pools. It is however, supported in dedicated SQL pools. See <a href="https://github.com/MicrosoftDocs/sql-docs/pull/6793" target="_blank" rel="noopener noreferrer">MicrosoftDocs/sql-docs/pull/6793</a></p><header><h1 class="h1Heading_27L5">Other Differences</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-tempdbinformation_schemacolumns"></a>1) <code>tempdb.INFORMATION_SCHEMA.COLUMNS</code><a class="hash-link" href="#1-tempdbinformation_schemacolumns" title="Direct link to heading">#</a></h2><blockquote><p><a href="https://feedback.azure.com/forums/307516-azure-synapse-analytics/suggestions/40068358-temporary-table-get-colunms-informations" target="_blank" rel="noopener noreferrer">relevant Uservoice idea</a> (suggested  Mar 31, 2020)</p></blockquote><p>This introduces challenges for the macro <code>get_columns_from_relation()</code>. Basically <code>get_columns_from_relation</code> works fine for normal relations becuase we have the normal <code>INFORMATION_SCHEMA.COLUMNS</code>. But when the relation is a temp table nothing is returned. </p><p>You can see the discussion in <a href="https://github.com/dbt-msft/dbt-synapse/pull/40#issuecomment-763502389" target="_blank" rel="noopener noreferrer">this PR</a> in which, we&#x27;re trying to come up with a robust solution as part of our release for <code>v0.19.0</code>.</p><p>This breaks the adapter&#x27;s ability use the snapshot (i.e. SCD type 2) materialization.</p><p>The current theory for the best work around is what&#x27;s suggested in in <a href="https://stackoverflow.com/questions/63800841/get-column-names-of-temp-table-in-azure-synapse-dw" target="_blank" rel="noopener noreferrer">this Stack Overflow post</a>, which is:</p><ol><li>if <code>get_columns_from_relation() is called and the relation is a temp table (i.e. starts with </code>#`) then:</li><li>call CTAS to select one from from the temp table<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> dbo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">temp_table_hack </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TOP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#actual_temp_table )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>recursively call <code>get_columns_from_relation()</code> on this new table</li><li>drop the non-temp table</li></ol><p>This isn&#x27;t very pretty, but at least this will dbt users have a frictionless experience moving their dbt projects between TSQL products.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-recursive-ctes"></a>2) Recursive CTEs<a class="hash-link" href="#2-recursive-ctes" title="Direct link to heading">#</a></h2><blockquote><p><a href="https://feedback.azure.com/forums/307516-azure-synapse-analytics/suggestions/14876727-support-for-recursive-cte" target="_blank" rel="noopener noreferrer">relevant Uservoice idea</a> (suggested: Oct 2016, under review: May 2018)</p></blockquote><p>Don&#x27;t have to explain this one too much, it&#x27;s covered clearly in <a href="https://docs.microsoft.com/en-us/sql/t-sql/queries/with-common-table-expression-transact-sql?view=sql-server-ver15#features-and-limitations-of-common-table-expressions-in--and-" target="_blank" rel="noopener noreferrer">the docs</a>. And there&#x27;s also <a href="https://dwgeek.com/azure-synapse-recursive-query-alternative-example.html/" target="_blank" rel="noopener noreferrer">documented workarounds</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-external-tables-of-type-rdbms"></a>3) External tables of type: <code>RDBMS</code><a class="hash-link" href="#3-external-tables-of-type-rdbms" title="Direct link to heading">#</a></h2><blockquote><p><a href="https://feedback.azure.com/forums/307516-azure-synapse-analytics/suggestions/39848365-support-rdbms-type-for-create-external-data-sour" target="_blank" rel="noopener noreferrer">relevant Uservoice idea</a> (suggested: Mar 2020)</p></blockquote><p>The limitation of only allowing 8 persistent connections at 100 DWU requires us to have downstream Azure SQL marts that we expose to end-users. We&#x27;re using RDBMS/&quot;Elastic Query&quot; External Tables in these Azure SQL dbs to get data from the ASDP.</p><p>However, we also often want to ingest from various applications&#x27; transactional databases. An Elastic Query connection from ASDP to these transactional db&#x27;s would save the work of having to set up ADF pipelines and introduce an intermediary blob layer between the db&#x27;s.</p><p>The other benefit would be more streamlined syntax b/w the Azure SQL products.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/dbt-msft/dbt-msft-docs/tree/documentation/docs/dbt-synapse/synapse_syntax_wishlist.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dbt-msft-docs/docs/dbt-synapse/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dbt-msft-docs/docs/ado_pipelines_example"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Azure DevOps Pipelines Example Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#goal" class="table-of-contents__link">goal</a></li><li><a href="#rationale" class="table-of-contents__link">rationale</a></li><li><a href="#1-table-valued-constructor" class="table-of-contents__link">1) Table Valued Constructor</a></li><li><a href="#2-merge" class="table-of-contents__link">2) <code>MERGE</code></a></li><li><a href="#3-drop--if-exists" class="table-of-contents__link">3) Drop ... if exists</a><ul><li><a href="#drop-tableviewschemaindex--if-exists" class="table-of-contents__link"><code>DROP [TABLE/VIEW/SCHEMA/INDEX] ... IF EXISTS</code></a></li></ul></li><li><a href="#4-accessing-data-from-blob-or-an-external-table" class="table-of-contents__link">4) Accessing data from blob or an external table</a><ul><li><a href="#openrowset-vs-create-external-table-vs-copy-into" class="table-of-contents__link"><code>OPENROWSET()</code> vs <code>CREATE EXTERNAL TABLE()</code> vs <code>COPY INTO</code></a></li></ul></li><li><a href="#4-nested-ctes" class="table-of-contents__link">4) Nested CTEs</a><ul><li><a href="#cant-be-done-in-asdp" class="table-of-contents__link">can&#39;t be done in ASDP</a></li></ul></li><li><a href="#5-sp_rename-unsupported-in-synapse-serverless-pools" class="table-of-contents__link">5) <code>sp_rename</code> unsupported in Synapse Serverless pools</a></li><li><a href="#1-tempdbinformation_schemacolumns" class="table-of-contents__link">1) <code>tempdb.INFORMATION_SCHEMA.COLUMNS</code></a></li><li><a href="#2-recursive-ctes" class="table-of-contents__link">2) Recursive CTEs</a></li><li><a href="#3-external-tables-of-type-rdbms" class="table-of-contents__link">3) External tables of type: <code>RDBMS</code></a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dbt-msft-docs/docs/dbt-sqlserver/overview">dbt-sqlserver</a></li><li class="footer__item"><a class="footer__link-item" href="/dbt-msft-docs/docs/dbt-synapse/overview">dbt-synapse</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://docs.getdbt.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>dbt<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/dbt-msft/dbt-sqlserver" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>dbt-sqlserver GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/dbt-msft/dbt-synapse" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>dbt-synapse GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 dbt-msft. Built with Docusaurus.</div></div></div></footer></div>
<script src="/dbt-msft-docs/assets/js/runtime~main.82d8ab17.js"></script>
<script src="/dbt-msft-docs/assets/js/main.51c2c29b.js"></script>
</body>
</html>